<!-- object row wrap layout -->
<mat-card *ngIf="getLayout() === 'object'" [fxLayout]="schema.layout === 'vertical' ? 'column' : 'row wrap'">
    <div *ngFor="let x of schema.properties | keyvalue:originalOrder" style="display: flex; margin: 2px">
        <div *ngIf="x.value.type">
            <lib-json-schema-form [label]="appendLabel(x.key)" [value]="value ? value[x.key] : undefined"
                (valueChange)="onValueChange(x.key, $event)" [schema]="x.value"></lib-json-schema-form>
        </div>
    </div>
</mat-card>

<!-- array row wrap layout -->
<mat-card *ngIf="getLayout() === 'array'" [fxLayout]="schema.layout === 'vertical' ? 'column' : 'row wrap'">
    <div *ngFor="let x of value; let i=index" style="display: flex; margin: 2px; position: relative"
        (mouseenter)="hover=i" (mouseleave)="hover=null">
        <lib-json-schema-form [label]="label" [(value)]="value[i]" [schema]="schema.items"></lib-json-schema-form>
        <button mat-icon-button (click)="remove(i)" class="example-handle"
            [style.visibility]="i===hover ? 'visible' : 'hidden'">
            <mat-icon>remove_circle_outline</mat-icon>
        </button>
    </div>
    <button mat-icon-button (click)="add()" matTooltip="{{label}}">
        <mat-icon>add_circle_outline</mat-icon>
    </button>
</mat-card>

<!-- array tab layout -->
<mat-tab-group *ngIf="getLayout() === 'tab'">
    <mat-tab *ngFor="let x of value; let i=index" style="margin: 2px; position: relative" [label]="''+i">
        <lib-json-schema-form [label]="label" [(value)]="value[i]" [schema]="schema.items"></lib-json-schema-form>
        <button mat-icon-button (click)="remove(i)" class="example-handle">
            <mat-icon>remove_circle_outline</mat-icon>
        </button>
    </mat-tab>
    <mat-tab>
        <ng-template mat-tab-label>
            <button mat-icon-button (click)="add()" matTooltip="{{label}}">
                <mat-icon>add_circle_outline</mat-icon>
            </button>
        </ng-template>
    </mat-tab>
</mat-tab-group>

<!-- array table layout -->
<mat-card *ngIf="getLayout() === 'table'">
    <table>
        <tr>
            <th *ngFor="let x of schema.items.properties | keyvalue:originalOrder">{{x.key}}</th>
            <th></th>
        </tr>
        <tr *ngFor="let row of value; let i=index">
            <td *ngFor="let x of schema.items.properties | keyvalue:originalOrder">
                <lib-json-schema-form [(value)]="row[x.key]" [schema]="schema.items.properties[x.key]">
                </lib-json-schema-form>
            </td>
            <td>
                <button mat-icon-button (click)="remove(i)">
                    <mat-icon>remove_circle_outline</mat-icon>
                </button>
            </td>
        </tr>
    </table>
    <button mat-icon-button (click)="add()" matTooltip="{{label}}">
        <mat-icon>add_circle_outline</mat-icon>
    </button>
</mat-card>

<!-- enum -->
<div *ngIf="getLayout() === 'enum'">
    <mat-form-field>
        <mat-label>{{label}}</mat-label>
        <mat-select [value]="value" (selectionChange)="change($event)">
            <mat-option *ngFor="let x of schema.enum" [value]="x">{{x}}</mat-option>
        </mat-select>
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>

<!-- date element -->
<div *ngIf="getLayout() === 'date'">
    <mat-form-field>
        <mat-label>{{label}}</mat-label>
        <input matInput [value]="value" (dateChange)="change($event)" [matDatepicker]="picker">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>

<!-- checkbox element -->
<div *ngIf="getLayout() === 'checkbox'">
    <mat-checkbox [checked]="value" (change)="change($event)">{{label}}</mat-checkbox>
    <p class="error">{{error()}}</p>
</div>

<!-- autocomplete element -->
<div *ngIf="getLayout() === 'autocomplete'">
    <mat-form-field *ngIf="schema.widget !== 'select'">
        <mat-label>{{label}}</mat-label>
        <input matInput [value]="value" (keyup)="filter($event)" (focus)="load()" (blur)="change($event)"
            [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete">
            <mat-option *ngFor="let option of filteredChoices" [value]="option">
                {{option}}
            </mat-option>
        </mat-autocomplete>
    </mat-form-field>
    <mat-form-field *ngIf="schema.widget === 'select'">
        <mat-label>{{label}}</mat-label>
        <mat-select [value]="value" (focus)="load()" (selectionChange)="change($event)">
            <mat-option *ngFor="let option of choices" [value]="option">
                {{option}}
            </mat-option>
        </mat-select>
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>

<!-- single element -->
<div *ngIf="getLayout() === 'single'">
    <mat-form-field>
        <mat-label>{{label}}</mat-label>
        <input matInput [type]="schema.widget" [value]="value" (change)="change($event)">
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>

<!-- textarea element -->
<div *ngIf="getLayout() === 'textarea'">
    <mat-form-field class="input-full-width">
        <mat-label>{{label}}</mat-label>
        <textarea matInput [value]="value" (change)="change($event)" rows="12"></textarea>
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>

<!-- large textarea element -->
<div *ngIf="getLayout() === 'largetextarea'">
    <mat-form-field class="input-large-width">
        <mat-label>{{label}}</mat-label>
        <textarea matInput [value]="value" (change)="change($event)" rows="24"></textarea>
    </mat-form-field>
    <p class="error">{{error()}}</p>
</div>


<!-- upload -->
<div *ngIf="getLayout() === 'upload'">
    <input type="file" id="file" (change)="handleFileInput($event)">
    <p class="error">{{error()}}</p>
</div>